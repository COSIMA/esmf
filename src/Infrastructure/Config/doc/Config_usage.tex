% $Id: Config_usage.tex,v 1.2.4.1 2005/03/29 17:17:49 jwolfe Exp $

 \subsubsection{Resource Files}

      A {\em Resource File} is a text file consisting of variable
     length lines (records), each possibly starting with a {\em label}
     (or {\em key}), followed by some data. A simple resource file 
     looks like this:

 \begin{verbatim}
 # Lines starting with # are comments which are
 # ignored during processing.
 my_file_names:         jan87.dat jan88.dat jan89.dat
 radius_of_the_earth:   6.37E6  # these are comments too
 constants:             3.1415   25
 my_favourite_colors:   green blue 022 # text & number are OK
 \end{verbatim}

    In this example, {\tt my\_file\_names:} and {\tt constants:}
    are labels, while {\tt jan87.dat, jan88.dat} and {\tt jan89.dat} are
    data associated with label {\tt my\_file\_names:}.
    Resource files can also contain simple tables of the form:

 \begin{verbatim}
 my_table_name::
  1000     3000     263.0   
   925     3000     263.0
   850     3000     263.0
   700     3000     269.0
   500     3000     287.0
   400     3000     295.8
   300     3000     295.8    
 ::
 \end{verbatim}

 Resource files are intended for random access (except between ::'s in a 
 table definition). Normally, the order of records should not be important. 
 However, the order of records may be important if the same label appears 
 multiple times.

    \subsubsection{A Quick Overview}

    The first step is to create the {\tt ESMF\_Config} and load the 
    ASCII resource (rc) file into memory\footnote{See next section 
    for a complete description of parameters for each routine/function}:

 \begin{verbatim}
       cf = ESMF_ConfigCreate(rc)
       call ESMF_ConfigLoadFile(cf, fname, layout, rc=rc)
 \end{verbatim}

    The next step is to select the label (record) of interest, say

 \begin{verbatim}
       call ESMF_ConfigFindLabel(cf, 'constants:', rc=rc)
 \end{verbatim}

  The two constants above can be retrieved with the following code
  fragment:
 \begin{verbatim}
       real    :: r
       integer :: i
       call ESMF_ConfigFindLabel(cf, 'constants:', rc=rc)
       call ESMF_ConfigGetAttribute(cf, r, rc=rc)       results in r = 3.1415
       call ESMF_ConfigGetAttribute(cf, i, rc=rc)       results in i = 25
 \end{verbatim}

  The file names above can be retrieved with the following
  code fragment:
 \begin{verbatim}
       character*20 :: fn1, fn2, fn3
       integer      :: rc
       call ESMF_ConfigFindLabel(cf, 'my_file_names:', rc=rc)
       call ESMF_ConfigGetAttribute(cf, fn1, rc=rc)   ==> fn1 = 'jan87.dat'
       call ESMF_ConfigGetAttribute(cf, fn2, rc=rc)   ==> fn1 = 'jan88.dat'
       call ESMF_ConfigGetAttribute(cf, fn3, rc=rc)   ==> fn1 = 'jan89.dat'
 \end{verbatim}

 To access the table above, the user first must use 
 {\tt ESMF\_ConfigFindLabel()} to locate the beginning of the table, e.g.,

 \begin{verbatim}
       call ESMF_ConfigFindLabel(cf, 'my_table_name::', rc=rc)
 \end{verbatim}

 Subsequently, {\tt call ESMF\_ConfigNextLine()} can be used to gain 
 access to each row of the table. Here is a code fragment to read the above
 table (7 rows, 3 columns):

 \begin{verbatim}
       real          :: table(7,3)
       character*20  :: word
       integer       :: rc
       call  ESMF_ConfigFindLabel(cf, 'my_table_name::', rc=rc)
       do i = 1, 7
          call ESMF_ConfigNextLine(cf, rc=rc)
          do j = 1, 3
             call ESMF_ConfigGetAttribute(cf, table(i,j), rc=rc)
          end do                   
       end do
 \end{verbatim}

 The work with the configuration file {\tt cf} is finalized by call to
 {\tt ESMF\_ConfigDestroy()}:
 \begin{verbatim}
       integer :: rc
       call ESMF_ConfigDestroy(cf, rc)
 \end{verbatim}

 {\em Common Arguments:}

 \begin{verbatim}
 character*(*) :: fname       file name
 integer       :: rc          error return code (0 is OK)
 character*(*) :: label       label (key) to locate record
 character*(*) :: word        blank delimited string
 character*(*) :: string      a sequence of characters
 \end{verbatim}


    \subsubsection{Package History}
       The ESMF Configuration Management Package was evolved by 
       Leonid Zaslavsky and Arlindo da Silva from Ipack90 package
       created by Arlindo da Silva at NASA DAO.

       Back in the 70's Eli Isaacson wrote IOPACK in Fortran
       66.  In June of 1987 Arlindo da Silva wrote Inpak77 using
       Fortran 77 string functions; Inpak 77 is a vastly
       simplified IOPACK, but has its own goodies not found in
       IOPACK.  Inpak 90 removes some obsolete functionality in
       Inpak77, and parses the whole resource file in memory for
       performance. 


