% $Id: ESMF_install.tex,v 1.40.2.1 2005/02/11 20:50:42 nscollins Exp $

\subsection{ESMF Download Options}

Major releases of the ESMF software can be downloaded by following
the instructions on the 
the {\bf Downloads \& Documentation} link on the ESMF 
website, \htmladdnormallink{http://www.esmf.ucar.edu}{http://www.esmf.ucar.edu}.

The ESMF is distributed as a full source code tree.  You will need
to compile the code into the {\tt libesmf.a} library.
On some platforms a shared library, {\tt libesmf.so}, is also created.
Follow the instructions in the following sections of the 
{\it Quick Start} guide, beginning with Section~\ref{InstallProcedures},
Installation, to build the library and link it with your application.

\subsection{Installation}
\label{InstallProcedures}

\input{ESMF_systemreq}

\subsubsection{ESMF Environment Variables}
\label{EnvironmentVariables}

Currently the ESMF\_DIR environment variable must be set on all
platforms.  ESMF\_DIR should be set to the path of the top
level ESMF directory.  

There are several other environment variables that the build system uses.
In most cases they do not have to be set by the user.  If they are not
set, then the build system will assign default values to them.  For the
current supported platforms, the default values are fine.  The other
environment variables are:
\begin{quote}
\begin{description}

  \item[ESMF\_ARCH] Variable that has the value of uname -s.  
                 For example, this will be AIX for IBM
                 RS6000's.  There should be no reason for the
                 user to set ESMF\_ARCH since the proper value should be
                 determined automatically.

  \item[ESMF\_BOPT] Build option value of g (for debug mode) or O (for
                 optimize mode).  Default value will be O.

  \item[ESMF\_COMM] Defines which MPI communications library to use.  
                 Many times a machine will come with its own MPI 
                 library and in those cases the default setting 
                 will be the native mpi.  Otherwise the default setting 
                 will be mpiuni so that the mpi stub library will be used.
                 Other possible settings are mpich and lam.

\item[ESMF\_COMPILER]

Variable specifying which compiler to use.  Value can be default,
absoft, intel, lahey, xlf, or nag.  If the value is default or
ESMF\_COMPILER is left unset, then the default compiler will be
used. On systems which usually come with a single vendor-supplied
compiler, the default is to use this compiler.  On systems like
Linux clusters where there is no single vendor compiler installed
on all systems, you will generally want to set this.
The default for Linux systems is lahey and on Darwin (Mac OS X)
systems it is absoft.

\item[ESMF\_C\_COMPILER]

Variable specifying which C/C++ compiler to use.   In most cases
this should not be set; the default is to use the vendor-supplied
compilers on those systems which normally come with a single
development environment; on other systems like Linux clusters,
the default is to use the ESMF\_COMPILER setting.  However, some
Fortran compilers support linking with C and C++ code compiled
with the GNU compilers; in these cases, you can set this variable
to the value gnu in order to compile with the vendor Fortran
compiler and the GNU C/C++.   This option is only supported for
ESMF\_ARCH=Darwin, ESMF\_COMPILER=xlf, and ESMF\_ARCH=Linux,
ESMF\_COMPILER=intel.

\item[ESMF\_C\_LIBRARY]

Variable specifying which C/C++ libraries to link with.  In most cases
this should not be set; the default is to use the vendor-supplied
libraries on those systems which normally come with a single
development environment; on other systems like Linux clusters,
the default is to use the ESMF\_COMPILER setting.  However, some
vendor compilers support compiling with their compilers but linking
with the GNU C/C++ libraries.
In these cases, you can set this variable
to the value gnu in order to link with the GNU C/C++ libraries.
This option is only supported for ESMF\_ARCH=Linux, ESMF\_COMPILER=intel.


  \item[ESMF\_EXHAUSTIVE] Variable specifying how to compile the unit tests.
                 If set to the value ON, then all unit tests will be compiled
                 and will be executed when the test is run.  If unset or set 
                 to any other value, only a subset of the unit tests will 
                 be included to verify basic functions.  Note that this
                 is a compile-time selection, not a run-time option.

  \item[ESMF\_NO\_IOCODE] This version of the framework is prepared to use
                 the {\tt netCDF} I/O library.  However, because the location
                 of the library and include files varies widely from 
                 system to system the support for I/O is disabled by default.
                 To enable support, edit build/common.mk and comment out the 
                 two lines which set ESMF\_NO\_IOCODE to ON and set the 
                 CPP flag,
                 and recompile.

  \item[ESMF\_PREC] Precision value of 32 or 64.  When possible the
                 default value will be 64, otherwise it will be 32.

  \item[ESMF\_SITE] Build configure file site name or the value default.  
                 If not set, then the value of default is assumed.


\end{description}
\end{quote}

On Alpha machines an additional environment variable needs
to be set:

\begin{quote}
\begin{description}
  \item[ESMF\_PROJECT] Load Sharing Facility (LSF) project name
\end{description}
\end{quote}

On an Alpha machine, test and demo applications are run using 
the bsub command.  The value of ESMF\_PROJECT is used as the 
argument for bsub's -P option. The -P option assigns a job to 
a specific project.  

Environment variables must be set in the user's shell and not
inside an ESMF makefile or build system file.  Here is an example 
of setting an environment variable in tcsh and csh shells:

\begin{verbatim}
  setenv ESMF_PREC 32
\end{verbatim}

In ksh shell environment variables are set this way:

\begin{verbatim}
  export ESMF_PREC=32
\end{verbatim}

Environment variables can also be set from the gmake command line:

\begin{verbatim}
  gmake ESMF_PREC=32
\end{verbatim}

\subsubsection{Supported Platforms}
\input{../../build/doc/user_arch}

Simultaneous multiple architecture builds are supported, with
one restriction; the test cases may only be run on one platform at a time. 

\subsubsection{Building the ESMF Libraries}
\label{BuildESMF}

% GNU make requirement.  File in build/doc
\input{../../build/doc/user_make}

Build the library with the command:
\begin{verbatim}
  gmake 
\end{verbatim}
or 
\begin{verbatim}
  gmake ESMF_BOPT=O
\end{verbatim}
  for an optimized version or
\begin{verbatim}
  gmake ESMF_BOPT=g  
\end{verbatim}
  for the debug version.

Build options that enable you to copy the library and *.mod files to
specified directories are explained in Section~\ref{BuildOptions}. 

Makefiles throughout the framework are configured to allow users to
compile files only in the directory where {\tt gmake} is entered. Shared
libraries are rebuilt only if necessary. In addition the entire ESMF
framework may be built from any directory by entering {\tt gmake all},
assuming that all the environmental variables are set correctly as
described in Section~\ref{EnvironmentVariables}.

Users may also run examples or execute unit tests of specific classes
by changing directories to the desired class {\tt examples} or {\tt tests} 
directories and entering {\tt gmake run\_examples} or 
{\tt gmake run\_tests}, respectively.  For non-multiprocessor machines,
uni-processor targets are available as {\tt gmake run\_examples\_uni} or
{\tt gmake run\_tests\_uni}.

\subsubsection{Building the ESMF Documentation}
\label{BuildDocumentation}

The documentation consists of an {\it ESMF User's Guide}, {\it ESMF Requirements 
Document}, and {\it ESMF Reference Manual for Fortran}.  
\noindent To build documentation:
\begin{verbatim}
  gmake doc              ! Builds the manuals, including pdf and html.
\end{verbatim}

\noindent The resulting documentation files will be
located in the top level directory \${ESMF\_DIR}/doc.

%%
%% nsc 22jun04 - this is no longer true, so i'm commenting it out for now.
%% when we make it work again, comment this section back in and update it.
%% 
%% \noindent To build documentation for one module:
%% 
%% \noindent First change directory to the where the desired module's documentation 
%% resides; for example, to build the {\tt TimeMgr} documentation start
%% with:
%% 
%% \begin{verbatim}
%% cd $ESMF_DIR/src/Infrastructure/TimeMgr/doc
%% \end{verbatim}
%% 
%% \noindent Next issue one of the following commands:
%% \begin{verbatim}
%%   gmake pdf      ! Builds local pdf files.
%%   gmake html     ! Builds local html files.
%%   gmake alldoc   ! Builds all of the local documents.
%% \end{verbatim}
%% 
%% \noindent The output from this local documentation build is in the top 
%% level {\tt doc} directory, as with the previous commands.
%% 
%% 


