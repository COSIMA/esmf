% $Id: AppDriver_desc.tex,v 1.19.2.1 2008/04/05 03:14:00 cdeluca Exp $
%
% Earth System Modeling Framework
% Copyright 2002-2008, University Corporation for Atmospheric Research, 
% Massachusetts Institute of Technology, Geophysical Fluid Dynamics 
% Laboratory, University of Michigan, National Centers for Environmental 
% Prediction, Los Alamos National Laboratory, Argonne National Laboratory, 
% NASA Goddard Space Flight Center.
% Licensed under the University of Illinois-NCSA License.

%\subsection{Description}

The ESMF Application Driver ({\tt ESMF\_AppDriver}), is a generic ESMF 
driver program that contains a ``main.''  Simpler applications may be
able to use an Application Driver without modification; for more
complex applications, an Application Driver can be used as an extendable 
template.

ESMF provides a number of different Application Drivers in the 
{\tt \$ESMF\_DIR/src/Superstructure/AppDriver} directory.
An appropriate one can be chosen depending on how the application
is to be structured.  Options when deciding how to structure an 
application include choices about:

\begin{description}

\item[Sequential vs. Concurrent Execution]

In a serial execution model every PET executes the same Gridded 
Component code until it has produced data needed by another 
Gridded Component, and then all PETs change to running the next 
Gridded Component or Coupler Component.  This has the appeal of 
simplicity of data consumption and production: when a Gridded 
Component starts all required data is available for use, and when 
a Gridded Component finishes all data produced is ready for consumption 
by the next Gridded Component.  This approach also has
the possibility of less data movement if the grid and
data decomposition is done such that each processor's memory contains
the data needed by the next Component.

In a concurrent execution model subgroups of PETs run
Gridded Components and all Gridded Components are active at the 
same time.  Data exchange must be coordinated between Gridded 
Components so that data deadlock does not occur.  This strategy 
has the advantage of allowing coupling to other Gridded Components 
at any time during the computational process, including not 
having to return to the calling level of code before making 
data available.  ESMF supports the concurrent mode of execution
but does not support asynchronous data transfer from within an 
executing Component at this time.

\item[Pairwise vs. Hub and Spoke]

Coupler Components are responsible for taking data from one
Gridded Component and putting it into the form expected by another 
Gridded Component.  This might include regridding, change of units, 
averaging, or binning.

Coupler Components can be written for {\it pairwise} data exchange: 
the Coupler Component takes data from a single Component and transforms 
it for use by another single Gridded Component.  This simplifies the 
structure of the Coupler Component code.

Couplers can also be written using a {\it hub and spoke} model where a
single Coupler accepts data from all other Components, can do data
merging or splitting, and formats data for all other Components.

Multiple Couplers, using either of the above two models or some mixture of
these approaches, are also possible.

\item[Implementation Language]

The ESMF framework currently has Fortran interfaces for all public functions. 
Some functions also have C interfaces, and the number of these is expected to 
increase over time. 


\item[Number of Executables]

On a multiple processor machine a cooperating job can be run 
by starting the same executable on all nodes.  All processors run the
same code, but the computation proceeds in parallel by each processor 
working on a different subset of data.  This is a {\bf SPMD} model, 
Single Program Multiple Data.  

The alternative is to start a different executable on different
processors.  This is a {\bf MPMD} model, Multiple Program Multiple Data.
There are complications with many job control systems on multiprocessor
machines in getting the different executables started, and getting
inter-process communcations established.  Currently ESMF does not
support MPMD.

\end{description}



